<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="Poi">

  <head>
    <metal:css fill-slot="css_slot">
      <style type="text/css" media="all"
        tal:content="string: @import url($portal_url/poi.css);"></style>
    </metal:css>
  </head>

<body>
  <div metal:fill-slot="main">
    <div metal:define-macro="body" 
      tal:define="openStates python:['open', 'in-progress'];
                  issueQueryString python:'%s/poi_issue_search?state=%s' % (here.absolute_url(), '&state='.join(openStates),)">

      <div metal:use-macro="here/document_actions/macros/document_actions">
        Document actions (print, sendto etc)
      </div>

      <h1 tal:content="here/Title" class="documentFirstHeading">
        Tracker Title
      </h1>
            
      <div class="documentDescription" tal:content="here/Description">
        Description.
      </div>
      
      <h2 i18n:translate="poi_heading_open_issues">Open issues</h2>
      
      <a class="issue-search-link" 
         tal:attributes="href string:${here/absolute_url}/poi_issue_search_form" 
         i18n:translate="poi_issue_search">Search for issues</a>
      
      <p i18n:translate="poi_help_open_issues">
          Click a topic, release or issue state to see all open issues in that
          category. For more advanced search options, click "search for issues".
      </p>


      <div id="open-issues-by-topic" class="issue-quick-search-box">
          <h3 i18n:translate="poi_heading_by_topic">By topic</h3>
          <ul>
              <tal:categories repeat="topic here/getTopicIds">
                <li tal:define="topicInfo python:here.getDataGridRow('availableTopics', topic);
                                issues python:here.getFilteredIssues(topic=topic, state=openStates)">
                <a tal:attributes="href string:${issueQueryString}&topic=${topicInfo/id};
                                   title topicInfo/description" 
                   tal:content="topicInfo/title" /> (<span tal:replace="python:len(issues)" />)
                </li>
              </tal:categories>
          </ul>
      </div>
      
      <div id="open-issues-by-release" class="issue-quick-search-box"
           tal:condition="here/isUsingReleases">
          <h3 i18n:translate="poi_heading_by_release">By release</h3>
          <ul>
              <tal:releases repeat="release here/getAvailableReleases">
                  <li tal:define="issues python:here.getFilteredIssues(release=release, state=openStates)"
                      tal:condition="nocall:issues">
                    <a tal:attributes="href string:${issueQueryString}&release=${release}"
                       tal:content="release" /> (<span tal:replace="python:len(issues)" />)
                  </li>
              </tal:releases>
          </ul>
      </div>
      
      <div id="open-issues-by-state" class="issue-quick-search-box"
           tal:define="issueStates here/getIssueWorkflowStates">
          <h3 i18n:translate="poi_heading_by_release">By state</h3>
          <ul>
              <tal:releases repeat="state issueStates">
                  <li tal:define="issues python:here.getFilteredIssues(state=state)">
                    <a tal:attributes="href string:${here/absolute_url}/poi_issue_search?state=${state}"
                       tal:content="python:issueStates.getValue(state)" /> (<span tal:replace="python:len(issues)" />)
                  </li>
              </tal:releases>
          </ul>
      </div>
      
      <div class="visualClear">&nbsp;</div>
      
      <tal:manager condition="python:member.getId() in here.getManagers()">
          <div id="unassigned-issues"
               tal:define="issues python:here.getFilteredIssues(state='unconfirmed')"
               tal:condition="nocall:issues">
               
               <h2 i18n:translate="poi_heading_unconfirmed_issues">Unconfirmed issues</h2>
               <p i18n:translate="poi_help_unconfirmed_issues">
                   The following issues have not yet been confirmed or assigned. Please
                   review them and take the appropriate action.
               </p>
               
               <metal:table use-macro="here/poi_issue_search/macros/issue_search_results" />
               
          </div>
          
          <div id="my-issues"
               tal:define="issues python:here.getFilteredIssues(state=openStates, responsible=member.getId())"
               tal:condition="nocall:issues">
               
               <h2 i18n:translate="poi_heading_my_issues">My open issues</h2>
               <p i18n:translate="poi_help_my_issues">
                   The following open issues are assigned to you.
               </p>
               
               <metal:table use-macro="here/poi_issue_search/macros/issue_search_results" />
               
          </div>
          
      </tal:manager>
      
    </div>

  </div>
</body>

</html>

