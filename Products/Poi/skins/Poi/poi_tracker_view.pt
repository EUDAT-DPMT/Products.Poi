<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="Poi">

  <head>
    <metal:css fill-slot="css_slot">
      <style type="text/css" media="all"
        tal:content="string: @import url($portal_url/poi.css);"></style>
    </metal:css>
  </head>

<body>
  <div metal:fill-slot="main">
    <div metal:define-macro="body" 
      tal:define="
        categoryIds  here/getCategoryIds;
        states       python:['open', 'in-progress', 'postponed', 'closed'];
        categoryName request/category | string:all;
        category     python:test(categoryName == 'all', None, categoryName);
        stateName    request/state | string:todo;
        state        python:test(stateName == 'all', None, stateName);
        state        python:test(stateName == 'todo', ['open', 'in-progress'], state);
        categories   python:test(category, [category], categoryIds)">

      <h1 tal:content="here/Title" class="documentFirstHeading">
        Tracker Title
      </h1>

      <div metal:use-macro="here/document_actions/macros/document_actions">
        Document actions (print, sendto etc)
      </div>

      <div id="state-selection-box">
        <ul>
          <li>
            <a class="state-link" tal:condition="python:stateName != 'todo'"
              tal:attributes="href string:${here/absolute_url}?category=${categoryName}&state=todo"
              i18n:translate="poi_state_todo"
              >To-do</a>
            <span class="disabled-link" 
              tal:condition="python:stateName == 'todo'">To-do</span>
          </li>
          <li>
            <a class="state-link" tal:condition="python:stateName != 'all'"
              tal:attributes="href string:${here/absolute_url}?category=${categoryName}&state=all"
              i18n:translate="poi_states_all"
              >All</a>
            <span class="disabled-link" 
              tal:condition="python:stateName == 'all'">All</span>
          </li>
          <li tal:repeat="s states">
            <a state="state-link" tal:condition="python:stateName != s"
              tal:attributes="href string:${here/absolute_url}?category=${categoryName}&state=${s}"
              tal:content="s"
              />
            <span class="disabled-link"
              tal:condition="python:stateName == s"
              tal:content="s"
              />
          </li>
        </ul>
      </div>
      
      <div id="all-categories-box" tal:condition="python:categoryName != 'all'">
        <a class="link-expand"
          tal:attributes="href string:${here/absolute_url}?state=${stateName}">
	        <span i18n:translate="poi_view_all_cats">View all categories</span>
	      </a>
      </div>
      
      <div class="documentDescription" tal:content="here/Description">
        Description.
      </div>

      <tal:categories repeat="cat categories">

        <tal:category define="categoryInfo python:here.getDataGridRow('categories', cat);
                              issues python:here.getFilteredIssues(cat, state)">
            
          <h2 tal:content="categoryInfo/title">Category Title</h2>
  
          <a class="link-expand"
               tal:condition="python:categoryName != cat"
               tal:attributes="href string:${here/absolute_url}?category=${cat}&state=all">
	          <span i18n:translate="poi_view_entire_category">
                View all issues in category
    	      </span>
          </a>   
  
          <div class="discreet" tal:content="categoryInfo/description">
                Category description
          </div>
          
          <tal:noissues tal:condition="not:nocall:issues">
            <div class="no-issues" i18n:translate="poi_no_issues_found">
                No issues found.
            </div>
          </tal:noissues>
            
          <dl tal:condition="issues">
            <tal:block repeat="issue issues">
              <dt>
                <a href="" tal:content="issue/Title" 
                   tal:define="review_state issue/review_state"
                   tal:attributes="href issue/getURL;
                                   class string:issue-$review_state">FAQ</a>
              </dt>
              <dd>
                <div tal:content="issue/Description">
                    Issue description
                </div>
              </dd>
            </tal:block>
          </dl>
        </tal:category>
        
      </tal:categories>
      
    </div>
    <div metal:use-macro="here/document_byline/macros/byline">
      Get the byline - contains details about author and modification date.
    </div>
  </div>
</body>

</html>

