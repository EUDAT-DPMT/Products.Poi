<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="Poi">

  <head>
    <metal:css fill-slot="css_slot">
      <style type="text/css" media="all"
        tal:content="string: @import url($portal_url/poi.css);"></style>
    </metal:css>
  </head>

<body>
<div metal:fill-slot="main"
        tal:define="wftool here/portal_workflow">
    
    <div metal:define-macro="body">

      <div metal:use-macro="here/document_actions/macros/document_actions">
        Document actions (print, sendto etc)
      </div>
      
      <h1 tal:content="here/Title" class="documentFirstHeading">
        Issue Title
      </h1>      
      
      <a href=""
          class="link-parent visualNoPrint"
          tal:define="parent_url python:here.navigationParent(here, template.getId())"
          tal:attributes="href parent_url">
          <span i18n:translate="poi_up_to_tracker">Up to issue tracker</span>
      </a>
      
      <table class="vertical listing issue-info-box">
          <tr tal:condition="here/isUsingReleases">
              <th i18n:translate="poi_label_release">Release:</th>
              <td>
                  <span tal:condition="python:here.getRelease() != '(UNASSIGNED)'" 
                        tal:replace="here/getRelease" />
                  <div tal:condition="python:here.getRelease() == '(UNASSIGNED)'" class="unassigned-field">
                      &mdash;
                  </div>
              </td>
          </tr>
          <tr>
              <th i18n:translate="poi_label_topic">Topic:</th>
              <td tal:content="python:here.aq_parent.getDataGridRow('availableTopics', here.getTopic())['title']" />
          </tr>
          <tr>
              <th i18n:translate="poi_label_category">Category:</th>
              <td tal:content="python:here.aq_parent.getDataGridRow('availableCategories', here.getCategory())['title']" />
          </tr>
          <tr>
              <th i18n:translate="poi_label_severity">Severity:</th>
              <td tal:content="here/getSeverity" />
          </tr>
          <tr>
              <th i18n:translate="poi_label_submitted_by">Submitted by:</th>
              <td tal:content="here/Creator" />
          </tr>
          <tr>
              <th i18n:translate="poi_label_submitted_on">Submitted on:</th>
              <td tal:content="python:here.toPortalTime(here.created())" />
          </tr>
          <tr>
              <th i18n:translate="poi_label_responsible">Responsible:</th>
              <td>
                  <span tal:condition="python:here.getResponsibleManager() != '(UNASSIGNED)'" 
                         tal:replace="here/getResponsibleManager" />
                  <div tal:condition="python:here.getResponsibleManager() == '(UNASSIGNED)'" class="unassigned-field">
                      &mdash;
                  </div>
              </td>
          </tr>
          <tr tal:define="state python:wftool.getInfoFor(here, 'review_state')">
              <th i18n:translate="poi_label_state">State:</th>
              <td tal:content="state" tal:attributes="class string:issue-${state}"/>
          </tr>
      </table>
      
      <div class="documentDescription" tal:content="here/Description" />
          
      <div tal:content="structure here/getDetails" />
  
      <div class="steps-to-reproduce" tal:condition="here/getSteps">
          <span i18n:translate="poi_label_steps">Steps to reproduce:</span>
            <ol>
                <li tal:repeat="step here/getSteps" tal:content="step" />
            </ol>
      </div>
      
      <div class="issue-attachment" tal:condition="python:here.getAttachment().get_size() &gt; 0">
          <div class="issue-attachment-label" i18n:translate="poi_label_attachment">Attached:</div>
          <metal:attachment use-macro="python:here.widget('attachment')"/>
      </div>
      
      <div class="visualClear"><!----></div>

      <tal:responses repeat="response python:here.getFolderContents(contentFilter = {'sort_on' : 'getId'}, full_objects = True)">
      
        <div class="response-details" metal:define-macro="response_view"
                tal:attributes="class python: test(response.Creator() == here.Creator(),
                                                   'response-clarification',
                                                   test(response.Creator() in here.getManagers(),
                                                        'response-reply', 'response-additional'))">
                  
          
            <div class="response-actions"
                  tal:condition="python:user.has_permission('Modify portal content', response)">
              <ul>
                <li class="edit-response">
                  <a href="" title="Edit this response"
                      tal:attributes="href string:${response/absolute_url}/base_edit"
                      i18n:attributes="title"
                      i18n:translate="poi_edit_response">Edit</a>
                </li>
                <li class="delete-response">
                  <a href="" title="Delete this response"
                      tal:attributes="href string:${response/absolute_url}/poi_response_delete_confirm"
                      i18n:attributes="title"
                      i18n:translate="poi_delete_response">Delete</a>
                </li>
              </ul>
            </div>
          
            <div class="response-info"
                 tal:define="stateBefore response/getIssueStateBefore;
                             stateAfter  response/getIssueStateAfter;">
              <span i18n:translate="poi_added_by">Added by</span>
              <span class="contact-user" tal:content="response/Creator" />
              <span i18n:translate="poi_added_on">on</span>
              <span class="contact-user" 
                    tal:content="python:here.toPortalTime(response.Date(), long_format=True)" />
              <div tal:condition="python:stateBefore and stateAfter and stateBefore != stateAfter">
                  <span i18n:translate="poi_response_state_change">Changed issue state:</span>
                  <span tal:replace="stateBefore" /> &rarr; <span tal:replace="stateAfter" />
              </div>
            </div>
      
            <div tal:content="structure response/getResponse" />
            
            <div class="issue-attachment" tal:condition="python:response.getAttachment().get_size() &gt; 0">
              <div class="issue-attachment-label" i18n:translate="poi_label_attachment">Attached:</div>
              <metal:attachment use-macro="python:response.widget('attachment')"/>
            </div>
      
        </div>
      
      </tal:responses>
      <div class="visualClear"><!----></div>
  </div>
</div>

</body>
</html>
