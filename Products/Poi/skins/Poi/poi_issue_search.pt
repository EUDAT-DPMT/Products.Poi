<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="Poi">

  <head>
    <metal:css fill-slot="css_slot">
      <style type="text/css" media="all"
        tal:content="string: @import url($portal_url/poi.css);"></style>
    </metal:css>
  </head>

<div metal:fill-slot="main"
     tal:define="rssQueryString python:here.getIssueSearchQueryString(request);
                 results   python:here.getFilteredIssues(request);
                 Batch    python:modules['Products.CMFPlone'].Batch;
                 DateTime python:modules['DateTime'].DateTime;
                 b_size   python:30;b_start python:0;b_start request/b_start | b_start;">

    <h1 i18n:translate="poi_heading_search_results">Issue search results</h1>

    <a href=""
          class="link-parent visualNoPrint"
          tal:attributes="href string:${here/absolute_url}/poi_issue_search_form">
          <span i18n:translate="poi_return_to_search">Return to search</span>
      </a>

    <div tal:condition="not:nocall:results">
        <p><strong i18n:translate="description_no_results_found">No results were found.</strong></p>
    </div>

    <div tal:define="batch python:Batch(results, b_size, int(b_start), orphan=1);
                     issues batch">

        <strong tal:condition="nocall:results">
            <span i18n:translate="batch_x_items_matching_your_criteria"><span i18n:name="number" tal:content="python:len(issues)">234</span> items matching your criteria.</span>
        </strong>

        <metal:block define-macro="issue_search_results">
            
            <div tal:condition="rssQueryString | nothing" class="issue-search-rss" metal:define-slot="rss-button">
                <a href="" tal:attributes="href string:${here/absolute_url}/poi-issue-search-rss.xml?${rssQueryString}">
                    <img i18n:attributes="title title_rss_feed; alt label_rss_feed;"
                        tal:attributes="src string:$portal_url/rss.gif"
                        src="rss.gif"
                        alt="RSS Feed"
                        title="RSS feed of these search results" />
                </a>
            </div>
            
            <table class="listing nosort issue-search-results" 
                tal:define="states here/getIssueWorkflowStates"
                tal:condition="nocall:issues">
                <thead>
                    <tr>
                        <th i18n:translate="listingheader_number">#</th>
                        <th i18n:translate="listingheader_title">Title</th>
                        <th i18n:translate="listingheader_release"
                            tal:condition="here/isUsingReleases">Release</th>
                        <th i18n:translate="listingheader_area">Area</th>
                        <th i18n:translate="listingheader_type">Type</th>
                        <th i18n:translate="listingheader_severity">Severity</th>
                        <th i18n:translate="listingheader_created">Created</th>
                        <th i18n:translate="listingheader_responsible">Responsible</th>
                        <th i18n:translate="listingheader_state">State</th>
                    </tr>
                </thead>
                <tbody>
                    <tal:issues repeat="item issues">
                        <tr tal:define="oddrow repeat/item/odd"
                            tal:attributes="class python:test(oddrow, 'even', 'odd')">
                            <td tal:content="item/getId">
                            </td>
                            <td>
                                <a tal:attributes="href  item/getURL;
                                                   title item/Description;" 
                                   tal:content="item/Title" />
                            </td>
                            <td tal:condition="here/isUsingReleases">
                                <span tal:define="releases here/getReleasesVocab"
                                      tal:condition="python:item.getRelease != '(UNASSIGNED)'"
                                      tal:replace="python:releases.getValue(item.getRelease)" />
                                <div tal:condition="python:item.getRelease == '(UNASSIGNED)'"
                                     style="text-align:center">&mdash;</div>
                            </td>
                            <td tal:content="python:here.getWrappedField('availableAreas').lookup(here, item.getArea, 'title')" 
                                tal:on-error="item/getArea"/>
                            <td tal:content="python:here.getWrappedField('availableIssueTypes').lookup(here, item.getIssueType, 'title')"
                                tal:on-error="item/getIssueType" />
                            <td tal:content="item/getSeverity" />
                            <td tal:content="python:here.toLocalizedTime(item.created)"/>
                            <td>
                                <span tal:condition="python:item.getResponsibleManager != '(UNASSIGNED)'"
                                      tal:replace="item/getResponsibleManager" />
                                <div tal:condition="python:item.getResponsibleManager == '(UNASSIGNED)'"
                                     style="text-align:center">&mdash;</div>
                            </td>
                            <td tal:attributes="class string:issue-${item/review_state}"
                                i18n:translate="" i18n:domain="plone"
                                tal:content="python:states.getValue(item.review_state)" />
                        </tr>
                    </tal:issues>
                </tbody>
            </table>
            
         </metal:block>
         
        <!-- Navigation -->
        <div metal:use-macro="here/batch_macros/macros/navigation" />

    </div>
</div>


</html>

