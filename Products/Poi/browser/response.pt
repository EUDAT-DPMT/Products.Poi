<div class="response-adder"
     i18n:domain="Poi">
  <h3>Current new-style responses</h3>
  <tal:responses repeat="response_info view/responses">
    <div class="response-reply"
         tal:define="id response_info/id;
                     response nocall:response_info/response;
                     html response_info/html;"
         tal:attributes="class string:response-${response/type}">
      <!-- XXX Show edit/delete buttons. -->
      Id: <span tal:content="id" />
      <div class="response-info">
        <span i18n:translate="poi_added_by">Added by</span>
        <span class="contact-user" 
              tal:content="python:here.poi_niceName(username=response.creator)" />
        <span i18n:translate="poi_added_on">on</span>
        <span class="contact-user" 
              tal:content="python:here.toLocalizedTime(response.date, long_format=True)" />
        <div tal:repeat="delta response/changes">
          <span i18n:translate="" tal:content="string:${delta/name}" />:
          <span class="issueChange" i18n:translate="" tal:content="delta/before" /> &rarr; <span class="issueChange" i18n:translate="" tal:content="delta/after" />
        </div>

      </div>
      <span tal:replace="structure html" />
    </div>
  </tal:responses>

  <h3>Add response</h3>

  <form method="post" action="@@create_response">

    <div class="field">
      <label for="response">Response</label>
      
      <div class="formHelp" id="response_help">Please enter your response below</div>
      <div>

        <tal:wysiwyg
            tal:condition="view/use_wysiwyg">
          <tal:block
              define="inputname string:response;
                      inputvalue string:;
                      portal_url context/portal_url;">
            <metal:block metal:use-macro="context/wysiwyg_support/macros/wysiwygEditorBox" />
          </tal:block>
        </tal:wysiwyg>

        <textarea
            tal:condition="not:view/use_wysiwyg"
            cols="40" rows="15" name="response" id="response"></textarea>
        
      </div>
      
    </div>

    <!-- XXX Show attachment upload widget. -->

    <!-- XXX Only show these options when the user has permission to
         use them. -->

    <div class="field">
      <label for="transition">Change issue state</label>
      
      <div class="formHelp"
           id="issueTransition_help">Select a change of state in the issue this response is for, if applicable</div>
      
      <tal:transitions
          repeat="transition view/transitions_for_display">
        <input class="noborder blurrable" name="transition"
               value="" id="transition_1" type="radio"
               tal:attributes="value transition/value;
                               id transition/value;
                               checked transition/checked;" />

        <label
            tal:attributes="for transition/value"
            tal:content="transition/label">No change</label>

        <br />
      </tal:transitions>
    </div>


    <div class="field">
      <label for="severity">Change issue severity</label>
          
      <div class="formHelp" id="severity_help">Select the severity for this issue</div>
      
      <tal:options
          repeat="option view/severities_for_display">
        <input class="noborder blurrable" name="severity"
               value="" id="" type="radio"
               tal:attributes="value option/value;
                               id option/value;
                               checked option/checked;" />

        <label
            tal:attributes="for option/value"
            tal:content="option/label">No change</label>

        <br />
      </tal:options>
    </div>

    <div class="field">
      <label for="responsibleManager">Change responsible manager</label>
      
      <div class="formHelp" id="manager_help">Select the responsible manager for this issue</div>
      
      <tal:options
          repeat="option view/managers_for_display">
        <input class="noborder blurrable" name="responsibleManager"
               value="" id="" type="radio"
               tal:attributes="value option/value;
                               id option/value;
                               checked option/checked;" />

        <label
            tal:attributes="for option/value"
            tal:content="option/label">No change</label>

        <br />
      </tal:options>
    </div>                

    <!-- Add control for targetRelease -->

    <div class="formControls">
      <input class="standalone" value="Submit" type="submit" />
    </div>
  </form>
</div>
